<div class="container">
  <h1>ServerApp Dashboard</h1>
  <p class="lead">Rails 8 JSON-RPC Demo - Data Receiver</p>

  <div class="row">
    <div class="col-md-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Total Received</h5>
          <h2 class="text-primary"><%= @total_received %></h2>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Processed</h5>
          <h2 class="text-success"><%= @processed_count %></h2>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Unprocessed</h5>
          <h2 class="text-warning"><%= @unprocessed_count %></h2>
        </div>
      </div>
    </div>
    
    <div class="col-md-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">JSON-RPC Status</h5>
          <h2 class="text-info">Active</h2>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5>Records by Type</h5>
        </div>
        <div class="card-body">
          <% if @records_by_type.any? %>
            <% @records_by_type.each do |type, count| %>
              <div class="d-flex justify-content-between">
                <span><%= type.humanize %></span>
                <span class="badge bg-primary"><%= count %></span>
              </div>
            <% end %>
          <% else %>
            <p class="text-muted">No records received yet</p>
          <% end %>
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5>Recent Records</h5>
        </div>
        <div class="card-body">
          <% if @recent_records.any? %>
            <% @recent_records.each do |record| %>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                  <strong><%= record.record_type.humanize %></strong>
                  <small class="text-muted d-block">ID: <%= record.source_id %></small>
                </div>
                <div>
                  <small class="text-muted">
                    <%= time_ago_in_words(record.received_at || record.created_at) %> ago
                  </small>
                </div>
              </div>
            <% end %>
            <div class="mt-3">
              <%= link_to "View All Records", received_records_path, class: "btn btn-primary btn-sm" %>
            </div>
          <% else %>
            <p class="text-muted">No records received yet</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5>ActiveDataFlow Status</h5>
        </div>
        <div class="card-body">
          <p><strong>Engine:</strong> Mounted at /active_data_flow</p>
          <p><strong>JSON-RPC Server:</strong> Listening on port 8999</p>
          <p><strong>Storage Backend:</strong> ActiveRecord (SQLite)</p>
          <p><strong>Auto-load DataFlows:</strong> Enabled</p>
          
          <div class="mt-3">
            <%= link_to "ActiveDataFlow Management", "/active_data_flow", class: "btn btn-outline-primary" %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
